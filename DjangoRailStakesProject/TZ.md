Техническое задание на проект: RailStakes - Система расчета железнодорожных тарифов
1. Цель проекта
    Создание веб-сервиса для расчета железнодорожных тарифов перевозок для сотрудников транспортных компаний. Система позволяет пользователям рассчитывать стоимость перевозки грузов между станциями с учетом типа вагона, веса груза и других параметров, используя внешнее API расчета тарифов. Сервис сохраняет историю расчетов для каждого пользователя и управляет лимитами запросов.

2. Роли пользователей
    Гость: Доступ только к странице авторизации.

    Авторизованный пользователь: Расчет тарифов через веб-форму, просмотр истории своих расчетов, отслеживание лимита запросов.

    Администратор: Управление справочниками (станции, грузы, типы вагонов), просмотр всех расчетов, управление квотами пользователей.

3. Модели данных (сущности)
    1. Station (Станция)
        Хранение информации о железнодорожных станциях

        Поля: code (код станции), name (название станции)

    2. Cargo (Груз)
        Справочник грузов для перевозки

        Поля: etsng_code (код ЕТСНГ), gng_code (код ГНГ), name (наименование груза)

    3. WagonType (Тип вагона)
        Справочник типов вагонов

        Поля: code (код типа), name (название типа), capacity_tons (грузоподъемность в тоннах)

    4. TariffQuery (Запрос тарифа)
        Основная сущность для хранения параметров запроса

        Поля: user, from_station, to_station, cargo, wagon_type, fstate, tstate, empt, owner, created_at и др.

    5. TariffWagon (Вагон в отправке)
        Информация о вагонах в запросе

        Поля: query, index, weight_kg, capacity_tons

    6. TariffResult (Результат расчета)
        Результаты расчета тарифа

        Поля: query, ok (статус), total_price, currency, raw_xml, error_text, calculated_at

    7. UserQuota (Квота пользователя)
        Управление лимитами запросов

        Поля: user, total_limit, used

4. Ключевой функционал (User Stories)
    Расчет тарифа: Авторизованный пользователь заполняет форму с параметрами перевозки (станции отправления/назначения, груз, тип вагона, вес), система отправляет запрос к API расчета тарифов и отображает результат.

    Автодополнение справочников: При вводе станции или груза в форме расчета система предлагает варианты из соответствующих справочников с поиском по коду или названию.

    История расчетов: Пользователь может просматривать все свои предыдущие запросы с результатами расчетов в хронологическом порядке.

    Управление лимитами: Система отслеживает количество использованных запросов пользователя и блокирует новые расчеты при исчерпании лимита.

    Администрирование справочников: Администратор может добавлять, редактировать и удалять записи в справочниках станций, грузов и типов вагонов.

5. Внешние интеграции и аналитика
    Внешние интеграции:
    API "ЖД-Тариф" от Альта-Софт: Внешнее API для расчета железнодорожных тарифов. Интеграция через библиотеку requests с обработкой XML-ответов.

    Библиотека requests: Для выполнения HTTP-запросов к внешнему API.

    XML-парсинг: Использование xml.etree.ElementTree для парсинга XML-ответов от API.

    Аналитика и обработка данных:
    Структурирование данных: Преобразование XML-ответов от API в структурированные словари Python.

    Валидация данных: Проверка корректности введенных пользователем параметров перед отправкой запроса.

    Логирование операций: Сохранение полной истории запросов и ответов в базе данных для анализа и отладки.

6. Технический стек
    Backend: Django 6.0

    База данных: PostgreSQL (dev), MySQL (prod)

    HTTP-клиент: Библиотека requests

    XML-обработка: Стандартная библиотека Python xml.etree.ElementTree

    Авторизация: Django Authentication System

    Администрирование: Django Admin с кастомизированными интерфейсами